<script>
  // --- helpers (your script, but fixed + usable) ---
  var _0xa = function (_0xb) {
    const _0xc = new URLSearchParams(window.location.search);
    return _0xc.get(_0xb);
  };

  var _0xd = function (_0xe, _0xf, _0x10) {
    if (!_0x10) return _0xe;
    const _0x11 = _0xe.includes("?") ? "&" : "?";
    return _0xe + _0x11 + _0xf + "=" + encodeURIComponent(_0x10);
  };

  var _0x12 = function () {
    return /Android/.test(navigator.userAgent);
  };

  // mode: "a" => Android intent://  |  "i" => iOS/mac Safari x-safari-https://
  var _0x13 = function (_0x14, _0x15) {
    let _0x16;
    try {
      _0x16 = new URL(_0x14);
    } catch (e) {
      return _0x14;
    }

    const host = _0x16.hostname;
    const path = _0x16.pathname + _0x16.search + _0x16.hash;

    if (_0x15 === "a") {
      // intent://HOST/PATH#Intent;scheme=https;end;
      return "intent://" + host + path + "#Intent;scheme=https;end;";
    } else {
      // x-safari-https://example.com/...
      const prefix = "x-safari-";
      return _0x14
        .replace(/^https:\/\//, prefix + "https://")
        .replace(/^http:\/\//, prefix + "http://");
    }
  };

  // NEW: takes destUrl directly (instead of requiring ?dest= in your page URL)
  function handleContinue(destUrl) {
    let _0x1f = destUrl || _0xa("dest");

    if (!_0x1f) {
      alert("Missing destination. Please use a valid link.");
      return;
    }

    // carry common tracking params from THIS landing page onto the outgoing link
    const qp = new URLSearchParams(window.location.search);
    const keys = [
      "utm_campaign",
      "utm_content",
      "mc_campaign_id",
      "mc_adset_name",
      "mc_adset_id",
      "mc_ad_id",
      "mc_pub",
      "source",
      "ttclid"
    ];

    keys.forEach((k) => {
      const v = qp.get(k);
      if (v && !_0x1f.includes(k + "=") && !_0x1f.includes(k.toLowerCase() + "=")) {
        _0x1f = _0xd(_0x1f, k, v);
      }
    });

    // build platform-friendly URL
    let finalUrl = _0x12() ? _0x13(_0x1f, "a") : _0x13(_0x1f, "i");

    // IMPORTANT: "external popup" in Safari -> must be triggered by a user click
    const win = window.open(finalUrl, "_blank", "noopener,noreferrer");
    if (!win) {
      // fallback if popup blocked
      window.location.href = finalUrl;
    }
  }

  // --- wire BOTH CTA buttons to open externally on click ---
  (function () {
    const btnOver21 = document.getElementById("cta-over21");
    const btnUnder21 = document.getElementById("cta-under21");

    function bind(a) {
      if (!a) return;
      a.addEventListener("click", function (e) {
        e.preventDefault();
        handleContinue(a.href);
      });
    }

    bind(btnOver21);
    bind(btnUnder21);
  })();
</script>
